Azure DNS & Traffic Manager | Traffic Manager & DNS Deep Dive

Praveen Korvi


Azure Traffic Manager is a DNS-based traffic load balancer. This service allows you to distribute traffic to your public facing applications( through internet) across the global Azure regions.

Generally when u run ur application you will select region and in that region in different availbility zones u will have ur applications then u will configure load balancer but ur application is running across different countries, that measn single site but famous in multiple countires.

Example: 
lets assume www.ABC.com is very famous in US and same as popular in INDIA also lot of trafic will from India and US as well as this will be in separate region and Us is in separate region
 so whatever the backend servers ur creating so those servers serving this application  so front end You should create trafic manager .Here trffic manager eually distribute load  to backend servers .

Generally we have a region inside region we have availability zones and in avaialbility zones we will create a VM and there u will create a load baalncer and trafic will comes to load blancer and moves to xones1,zone2,zone3 .

If ur application is in across regions  so ur application one server is in US and other server is in INDIA why because who ever trying to access ur application the reuest shouldnt only goes to US and it should be goes to India as well as likewise we have to configure in this senario we will use trafic manager .

scenario:
 we are going to create a VM in  EAST US and another VM in west US and we will create a trafic manger , Est US and WESTUS were endpoints to trafic manager and whoevrr accessing through internet so it will come to the trafic manger and trafic managaer will routes trafic to these machines in 2 regions ,letss ay here if i install ngnix applications on both regions.
 step1: Resource group 
 we can create single resource group or u can create different reosurce groups as well 
 when we create vms by defalt they were having public Ips so this is a DNS based load balancing meanss this traffic manager will not recognise this machine IPS ,in trafic manger we will trying to create endpoints ,while creating end points we need to give machines information then we are going to get one IP but traffic manager not going to recognise  IP so we should give the DNS names then only it will recognise .

####################################################################
az group create -l westus -n AzureTraffic-DNS

az network vnet create -g AzureTraffic-DNS --location eastus -n EASTUS-RG-vNET1 --address-prefix 10.10.0.0/16 --subnet-name EASTUS-RG-subnet1 --subnet-prefix 10.10.1.0/24
az network vnet create -g AzureTraffic-DNS --location westus -n WESTUS-01-vNET1 --address-prefix 172.16.0.0/16 --subnet-name WESTUS-01-subnet1 --subnet-prefix 172.16.1.0/24


az vm create --resource-group AzureTraffic-DNS --location eastus --name EASTUS-VM1 --image UbuntuLTS --vnet-name EASTUS-RG-vNET1 \
--subnet EASTUS-RG-subnet1 --admin-username cloudfreak --admin-password "Zoom@12345678" --size Standard_B1s

az vm create --resource-group AzureTraffic-DNS --location westus --name WESTUS-VM1 --image UbuntuLTS --vnet-name WESTUS-01-vNET1 \
--subnet WESTUS-01-subnet1 --admin-username cloudfreak --admin-password "Zoom@12345678" --size Standard_B1s 


*****************************************************************************************
what is DNS?
-------------------
Remembering Ips is difficult 

private DNS: It means we are configuring our domain names and under that we are going to create records 
eupdviapp001.infosys.com like wise
 eu-europe
 pd:prod
vi-virtual machine
  app: application 
Public  DNS servers: 
  we dont manage it , whatevr we are accesing so many websites like google.com,flipkart.com all these websites are frontend userfriendly purpose its an alias names but in the baxckend they will use ip address only ,end of the day websites were running with Ips only , 
whenever we buy any domain name that domain name should be added to public DNS servers so that it can be accessed throughout the world and if this machine entries were added in ur  DNS then within this network only it will accessible thats why we called it as private DNS which we were managing ,public DNS we are not managing .
we will purchase the domans from GODADY, BIGROCK ,thse web hosting platforms will host my website on their servers he will add my doman anme into public dns servers then only it will visisble to across the world otherwise it wont  accaess it via internet .

install nginx websever for testing
 sudo at update
 apt installl nginx
 /etc/init.d/nginx status( to check )

add inbound rule in nsg 

once trafic manger is created 

create an endpoints in trafic manager  
 why trafic manger is not recognising ip address because when ip is changed then it will not send trafiic to vms 

Trafic manager-->End points -->ADD --> 

Type
Azure endpoint
Name: eastusendpoint
Target resource type: public IPaddrsses
 weight value : we have to give

after configuring DNS on VM only we can able to pickup ipaddress  then add

create DNS:
  eastusvm001.eastus.cloudapp.azure.com  looks like this 
  eastusvm001  this we added name 

we will create a DNS zones and we will write alias 
basicaly it is like valaxy.traficmanger.net  if we give aias means  valaxy.in or valaxy.com etc .

In this demonestration we have used only 2 vms in different regions but in real worls we have multiple vms we will place across multiple regions.

Basicaly trffic manger identifies the DNS names but backend it uses the public IPS 
after adding endpoints in Trafic manager ,DNS name looks like this

  DNS name
:
http://balu.trafficmanager.net

here our reuirement is  traficmanager.net is the doman name which was provided by azure whennwe want our own doman name means  balu.in, balu.com likewise .

public DNS:
   we will get it from   DNS zones in azure, In aws we will have ROUTE53 we will purchase doamin names from it if u buy domain then aws will mantans the DNS names ,but azure is not providing any facility to buy a doman names so obviously we whave to go through GODADDY any purchase doman names .
Once we buy a doman names from godaddy they have their own public DNS servers and they will add their particular doman anames insides their DNS servers assuming that ur going to host the application whata re the purpose u  purchases doman they will host on their backend servers , but we have our own environment here everything is ready ,
we just want only domain name for that purpose we will create a DNS Zones here and whatever the four DNS servers we will get that names we are going to  update in the GODADDY , so whenever someone is going to access through internet this particular ABC.COM this will go to the GODADDY then back in it send to the DNS servers about the entry and when it sent information to this DNS servers here we have a records  balu.in is alias to  http://balu.trafficmanager.net  name so this send trafic to traffic manger , In DNS zones we will going to create records balu.trafficmanager.net  alias balu.in      alias means its a duplicate name 

for suppose www.init6tech.com  basically in GOdaddy once we create alias in DNS zones then we will get 4 DNS servers then azure DNS servers will be added to GODady ,so whenever user so whenever someone is going to access through internet this particular ABC.COM this will go to the GODADDY then back in it send to the DNS servers about the entry and when it sent information to this DNS servers here we have a records  balu.in is alias to  http://balu.trafficmanager.net  name so this send trafic to traffic manger .

create DNS ZONES:
  Name should be whatever ur doman name ur purchasing from godaddy that should be name of DNs zones like  init6tech.com we have to add ,you should give whatever the doman name u purchased it should give here 
